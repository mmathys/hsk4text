{"version":3,"sources":["Text.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["shouldUsePrefix","lines","map","l","split","length","reduce","p","n","Text","props","useState","text","setText","splitFirst","x","arr","trim","prefix","rest","slice","c","useEffect","a","key","getKey","config","fetch","res","prefixed","unprefixed","fetchText","className","row","PauseKeys","SkipLeftKeys","SkipRightKeys","UpKeys","DownKeys","lesson","App","setConfig","activeText","setActiveText","selectedLesson","setSelectedLesson","audioRef","useRef","json","fetchData","keyHandler","keys","event","includes","preventDefault","useKeyPress","pause","left","right","up","down","current","paused","play","currentTime","newText","numLessons","texts","indexOf","undefined","selectLesson","lesson_num","subitems","entries","entryClassName","entry","onClick","load","grouped","_","groupBy","parseInt","nav","title","controls","ref","src","type","content","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.d83959bb.chunk.js","sourcesContent":["import { useEffect, useState } from \"react\";\nimport { getKey, TextConfig } from \"./App\";\nimport \"./Text.css\";\n\ntype TextProps = {\n  config: TextConfig;\n};\n\nconst shouldUsePrefix = (lines: string[]) => {\n  const validLine = lines.map((l) => {\n    const arr = l.split(\"：\");\n    if (arr[0].length <= 4) return true;\n    else return false;\n  });\n\n  return validLine.reduce((p, n) => p && n);\n};\n\nexport function Text(props: TextProps) {\n  const [text, setText] = useState<string[][]>();\n\n  const splitFirst = (x: string) => {\n    const arr = x.split(\"：\");\n    if (arr.length === 1) return [\"\", arr[0].trim()];\n    else {\n      const prefix = arr[0] + \"：\";\n      const rest = arr.slice(1).reduce((p, c) => p + \"：\" + c);\n      return [prefix.trim(), rest.trim()];\n    }\n  };\n\n  useEffect(() => {\n    const fetchText = async () => {\n      const key = getKey(props.config);\n      const res = await fetch(`text/${key}.txt`);\n      const text = await res.text();\n      const lines = text.split(\"\\n\");\n      if (shouldUsePrefix(lines)) {\n        const prefixed = lines.map(splitFirst);\n        setText(prefixed);\n      } else {\n        const unprefixed = lines.map((l) => [\"\", l]);\n        setText(unprefixed);\n      }\n    };\n\n    fetchText();\n  }, [props]);\n\n  return (\n    <div>\n      <div className=\"table\">\n        {text?.map((row) => {\n          return (\n            <div key={row[1]} className=\"row\">\n              <p className=\"cell dialog-head\">{row[0]}</p>\n              <p className=\"cell\">{row[1]}</p>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","import { useEffect, useRef, useState } from \"react\"\nimport { useKeyPress } from \"react-use\"\nimport \"./App.css\"\nimport { Text } from \"./Text\"\nimport _ from \"lodash\"\n\nconst PauseKeys = [\"k\", \" \"]\nconst SkipLeftKeys = [\"j\", \"ArrowLeft\"]\nconst SkipRightKeys = [\"l\", \"ArrowRight\"]\nconst UpKeys = [\"ArrowUp\", \"i\"]\nconst DownKeys = [\"ArrowDown\", \"m\"]\n\nexport type TextConfig = {\n  lesson: number\n  text: number\n  title: string | undefined\n}\n\ntype Config = {\n  texts: [TextConfig]\n}\n\nexport function getKey(config: TextConfig | undefined) {\n  if (!config) return\n  return (config.lesson < 10 ? \"0\" : \"\") + config.lesson + \"-\" + config.text\n}\n\nfunction App() {\n  const [config, setConfig] = useState<Config>()\n  const [activeText, setActiveText] = useState<TextConfig>()\n  const [selectedLesson, setSelectedLesson] = useState<number>(-1)\n  const audioRef = useRef<HTMLAudioElement>(null)\n\n  useEffect(() => {\n    const fetchData = async () => {\n      const res = await fetch(\"config.json\")\n      const json: Config = await res.json()\n      setConfig(json)\n    }\n\n    fetchData()\n  }, [])\n\n  const setText = (entry: TextConfig) => {\n    setActiveText(entry)\n    if (audioRef.current) {\n      audioRef.current.load()\n    }\n  }\n\n  const nav = () => {\n    if (!config) return\n\n    const selectLesson = (lesson_num: number) => () => {\n      if (lesson_num === selectedLesson) {\n        setSelectedLesson(-1)\n      } else {\n        setSelectedLesson(lesson_num)\n      }\n    }\n\n    const subitems = (entries: TextConfig[], lesson_num: number) => {\n      if (lesson_num !== selectedLesson) return\n      const entryClassName = (entry: TextConfig) => \"nav-entry\" + (entry === activeText ? \" active\" : \"\")\n      return entries.map((entry) => (\n        <div className={entryClassName(entry)} key={getKey(entry)} onClick={() => setText(entry)}>\n          Text {entry.text}\n        </div>\n      ))\n    }\n\n    const grouped = _.groupBy(config.texts, (c: TextConfig) => c.lesson)\n    const keys = _.keys(grouped)\n    return keys.map((lesson: string) => {\n      const lesson_num = parseInt(lesson)\n      const entries = grouped[lesson]\n      const className = \"nav-lesson\" + (lesson_num === activeText?.lesson ? \" active\" : \"\")\n      return (\n        <div key={lesson}>\n          <p className={className} onClick={selectLesson(lesson_num)}>\n            Lesson {lesson}\n          </p>\n          {subitems(entries, lesson_num)}\n        </div>\n      )\n    })\n  }\n\n  const content = () => {\n    if (!activeText) return\n    const title = () => {\n      if (!activeText.title) return\n      else return <p className=\"title\">{activeText.title}</p>\n    }\n    return (\n      <div className=\"text chinese\">\n        {title()}\n        <Text config={activeText}></Text>\n        <audio className=\"audio\" controls ref={audioRef}>\n          <source src={`audio/${getKey(activeText)}.mp3`} type=\"audio/mpeg\" />\n          Your browser does not support the audio element.\n        </audio>\n      </div>\n    )\n  }\n\n  const keyHandler = (keys: string[]) => (event: KeyboardEvent) => {\n    if (keys.includes(event.key)) {\n      event.preventDefault()\n      return true\n    }\n    return false\n  }\n\n  const [pause] = useKeyPress(keyHandler(PauseKeys))\n  const [left] = useKeyPress(keyHandler(SkipLeftKeys))\n  const [right] = useKeyPress(keyHandler(SkipRightKeys))\n  const [up] = useKeyPress(keyHandler(UpKeys))\n  const [down] = useKeyPress(keyHandler(DownKeys))\n\n  useEffect(() => {\n    if (pause) {\n      if (audioRef.current?.paused) audioRef.current?.play()\n      else audioRef.current?.pause()\n    }\n  }, [pause])\n\n  useEffect(() => {\n    if (!audioRef.current) return\n    if (left) audioRef.current.currentTime -= 5\n    if (right) audioRef.current.currentTime += 5\n  }, [left, right, audioRef])\n\n  useEffect(() => {\n    if (!config) return\n    const numLessons = config.texts.length\n    const lesson = activeText && config.texts.indexOf(activeText)\n\n    let newText\n    if (down) {\n      if (lesson !== undefined) {\n        newText = config.texts[lesson + 1]\n      } else {\n        newText = config.texts[0]\n      }\n    }\n\n    if (up) {\n      if (lesson !== undefined) {\n        newText = config.texts[lesson - 1]\n      } else {\n        newText = config.texts[numLessons - 1]\n      }\n    }\n\n    if (newText) {\n      setActiveText(newText)\n      setSelectedLesson(newText.lesson)\n    }\n  }, [up, down, config])\n\n  return (\n    <div className=\"App\">\n      <div className=\"content\">\n        <div className=\"nav\">{nav()}</div>\n        {content()}\n      </div>\n    </div>\n  )\n}\n\nexport default App\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}